<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>OS Flow â€¢ CobranÃ§a</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/global.css">
</head>

<body>
  <div class="layout" id="mainLayout">
    <div class="sidebar-wrapper">
      <aside class="sidebar">
        <div class="sidebar-logo">
          <div class="sidebar-logo-icon" onclick="toggleSidebar()">OS</div>
          <div class="sidebar-logo-text">
            <h1>OS Flow</h1>
            <small>Dashboard Inteligente</small>
          </div>
        </div>

        <ul class="menu">
          <li><a href="index.html"><span class="menu-icon">ğŸ“Š</span><span class="menu-text">Dashboard</span><span class="menu-tooltip">Dashboard</span></a></li>
          <li><a href="cadastrar-clientes.html"><span class="menu-icon">ğŸ‘¥</span><span class="menu-text">Clientes</span><span class="menu-tooltip">Clientes</span></a></li>
          <li><a href="produtos.html"><span class="menu-icon">ğŸ“¦</span><span class="menu-text">Produtos</span><span class="menu-tooltip">Produtos</span></a></li>
          <li><a href="servicos.html"><span class="menu-icon">ğŸ”§</span><span class="menu-text">ServiÃ§os</span><span class="menu-tooltip">ServiÃ§os</span></a></li>
          <li><a href="vendas.html"><span class="menu-icon">ğŸ’°</span><span class="menu-text">Vendas</span><span class="menu-tooltip">Vendas</span></a></li>
          <li><a href="ordem-servico.html"><span class="menu-icon">ğŸ“‹</span><span class="menu-text">Ordens</span><span class="menu-tooltip">Ordens</span></a></li>
          <li><a href="garantias.html"><span class="menu-icon">ğŸ›¡ï¸</span><span class="menu-text">Garantias</span><span class="menu-tooltip">Garantias</span></a></li>
          <li><a href="arquivos.html"><span class="menu-icon">ğŸ“</span><span class="menu-text">Arquivos</span><span class="menu-tooltip">Arquivos</span></a></li>
          <li><a href="financeiro.html"><span class="menu-icon">ğŸ’³</span><span class="menu-text">Financeiro</span><span class="menu-tooltip">Financeiro</span></a></li>
          <li><a href="cobranca.html" class="active"><span class="menu-icon">ğŸ“„</span><span class="menu-text">CobranÃ§a</span><span class="menu-tooltip">CobranÃ§a</span></a></li>
          <li><a href="configuracoes.html"><span class="menu-icon">âš™ï¸</span><span class="menu-text">ConfiguraÃ§Ãµes</span><span class="menu-tooltip">ConfiguraÃ§Ãµes</span></a></li>
        </ul>

        <div class="sidebar-footer">v3.8.1 â€¢ Â© <span id="ano-atual"></span> â€¢ OS Flow</div>
      </aside>
    </div>

    <div class="main-wrapper">
      <header class="topbar">
        <div class="topbar-title">
          CobranÃ§a
          <div class="breadcrumb"><span>RecebÃ­veis</span></div>
        </div>
        <div class="user-info">
          <span>Bem-vindo, <strong id="topUserName">UsuÃ¡rio</strong></span>
          <div class="user-avatar" id="topUserAvatar">U</div>
        </div>
      </header>

      <main class="content">
        <div class="page-header">
          <h1>CobranÃ§as</h1>
          <div class="actions">
            <button class="btn" type="button" onclick="abrirModalNovaCobranca()">â• Nova cobranÃ§a</button>
            <button class="btn btn-primary" type="button" onclick="refresh()">ğŸ”„ Atualizar</button>
          </div>
        </div>

        <div class="grid">
          <!-- esquerda: lista -->
          <div>
            <section class="panel">
              <div class="panel-title">
                <span>ğŸ“‹ Lista de cobranÃ§as</span>
                <small>localStorage: <span style="font-family: ui-monospace, Menlo, monospace;">osflow:cobrancas</span></small>
              </div>

              <div class="form-row">
                <div class="field">
                  <label for="filtroStatus">Status</label>
                  <select id="filtroStatus" onchange="render()">
                    <option value="">Todos</option>
                    <option value="aberta">Aberta</option>
                    <option value="atrasada">Atrasada</option>
                    <option value="parcial">Parcial</option>
                    <option value="paga">Paga</option>
                    <option value="cancelada">Cancelada</option>
                    <option value="rascunho">Rascunho</option>
                  </select>
                </div>
                <div class="field">
                  <label for="filtroBusca">Buscar</label>
                  <input id="filtroBusca" placeholder="Cliente, venda, descriÃ§Ã£o..." oninput="render()" />
                </div>
              </div>

              <div style="overflow:auto;">
                <table class="table" aria-label="CobranÃ§as">
                  <thead>
                    <tr>
                      <th>Cliente</th>
                      <th>Origem</th>
                      <th>Vencimento</th>
                      <th>Valor</th>
                      <th>Status</th>
                      <th style="width: 300px;">AÃ§Ãµes</th>
                    </tr>
                  </thead>
                  <tbody id="cobrancasTbody"></tbody>
                </table>
              </div>

              <div id="cobrancasEmpty" class="empty" style="display:none; margin-top: var(--space-4);">
                Nenhuma cobranÃ§a ainda. Crie uma nova ou gere a partir de uma venda.
              </div>
            </section>
          </div>

          <!-- direita: detalhes / integraÃ§Ãµes -->
          <div>
            <section class="panel">
              <div class="panel-title">
                <span>ğŸ§© IntegraÃ§Ãµes (reservado)</span>
                <small>Mercado Pago + WhatsApp</small>
              </div>

              <div class="field" style="margin-bottom:0;">
                <label>Status de integraÃ§Ã£o</label>
                <div class="hint" id="integracoesHint">
                  Conectores ainda nÃ£o implementados. Configure tokens em <strong>ConfiguraÃ§Ãµes</strong>.
                </div>
              </div>

              <div class="divider"></div>

              <div class="field">
                <label>Mercado Pago</label>
                <div class="hint" id="mpHint">â€”</div>
              </div>

              <div class="field" style="margin-bottom:0;">
                <label>WhatsApp</label>
                <div class="hint" id="waHint">â€”</div>
              </div>
            </section>

            <section class="panel">
              <div class="panel-title">
                <span>â° Lembretes (local)</span>
                <small>pendÃªncias do dia</small>
              </div>

              <div id="lembretesBox" class="empty">
                Nenhum lembrete no momento.
              </div>
            </section>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- MODAL: Nova cobranÃ§a (manual) -->
  <div class="modal-backdrop" id="modalNovaCobranca">
    <div class="modal">
      <div class="modal-header">
        <h3>â• Nova cobranÃ§a (manual)</h3>
        <button class="modal-close" type="button" onclick="fecharModalNovaCobranca()">Ã—</button>
      </div>

      <div class="field">
        <label for="mcOrigemTipo">Origem</label>
        <select id="mcOrigemTipo" onchange="toggleOrigemRef()">
          <option value="manual">Manual</option>
          <option value="venda">Venda</option>
          <option value="os">OS</option>
        </select>
        <div class="hint">Por enquanto, â€œVendaâ€ e â€œOSâ€ sÃ£o sÃ³ referÃªncia (sem importar itens automaticamente).</div>
      </div>

      <!-- somente cliente cadastrado -->
      <div class="form-row">
        <div class="field">
          <label for="mcClienteSelect">Cliente (cadastrado)</label>
          <select id="mcClienteSelect"></select>
          <div class="hint">Somente clientes <strong>ativos</strong> aparecem aqui.</div>
        </div>
        <div class="field">
          <label for="mcClienteId">ClienteId</label>
          <input id="mcClienteId" placeholder="id do cliente" readonly />
          <div class="hint">Preenchido automaticamente ao selecionar o cliente.</div>
        </div>
      </div>

      <div class="field">
        <label for="mcClienteNome">Cliente (nome)</label>
        <input id="mcClienteNome" placeholder="Nome do cliente" readonly />
      </div>

      <div class="form-row">
        <div class="field">
          <label for="mcValor">Valor total</label>
          <input id="mcValor" type="number" step="0.01" placeholder="0.00" />
        </div>
        <div class="field">
          <label for="mcVencimento">Vencimento</label>
          <input id="mcVencimento" type="date" />
        </div>
      </div>

      <div class="form-row">
        <div class="field">
          <label for="mcParcelas">Parcelas</label>
          <input id="mcParcelas" type="number" min="1" max="36" value="1" />
        </div>
        <div class="field">
          <label for="mcDescricao">DescriÃ§Ã£o</label>
          <input id="mcDescricao" placeholder="Ex: ServiÃ§o / Venda / OS" />
        </div>
      </div>

      <div class="divider"></div>

      <div class="panel-title" style="margin-top:0;">
        <span>Reservas p/ API (nÃ£o funcional)</span>
        <small>somente placeholders</small>
      </div>

      <div class="form-row">
        <div class="field">
          <label for="mcMpPreferenceId">MP preferenceId</label>
          <input id="mcMpPreferenceId" placeholder="serÃ¡ preenchido pela API" disabled />
        </div>
        <div class="field">
          <label for="mcWaMessageId">WA messageId</label>
          <input id="mcWaMessageId" placeholder="serÃ¡ preenchido pela API" disabled />
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn" type="button" onclick="fecharModalNovaCobranca()">Cancelar</button>
        <button class="btn btn-success" type="button" onclick="criarCobrancaManual()">Criar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Detalhes -->
  <div class="modal-backdrop" id="modalDetalhe">
    <div class="modal">
      <div class="modal-header">
        <h3 id="detalheTitulo">Detalhes</h3>
        <button class="modal-close" type="button" onclick="fecharModalDetalhe()">Ã—</button>
      </div>

      <div id="detalheCorpo"></div>

      <div class="modal-actions">
        <button class="btn" type="button" onclick="fecharModalDetalhe()">Fechar</button>
      </div>
    </div>
  </div>
  <script src="js/cobranca.js"></script>
</body>
</html>